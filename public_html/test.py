import glob

scanids = [
  '1002',
  '1003',
  '1004',
  '1006',
  '1007',
  '1008',
  '1009',
  '1014',
  '1016',
  '1018',
  '1019',
  '1022',
  '1023',
  '1026',
  '1027',
  '1038',
  '1039',
  '1041',
  '1047',
  '1048',
  '1049',
  '1050',
  '1052',
  '1054',
  '1055',
  '1056',
  '1057',
  '1058',
  '1059',
  '1060',
  '1061',
  '1062',
  '1063',
  '1064',
  '1065',
  '1066',
  '1067',
  '1068',
  '1069',
  '1070',
  '1071',
  '1072',
  '1073',
  '1074',
  '1075',
  '1076',
  '1077',
  '1078',
  '1079',
  '1080',
  '1081',
  '1082',
  '1083',
  '1084',
  '1085',
  '1086',
  '1087',
  '1088',
  '1089',
  '1090',
  '1091',
  '1092',
  '1093',
  '1098',
  '1099',
  '1100',
  '1101',
  '1106',
  '1107',
  '1108',
  '1109',
  '1110',
  '1111',
  '1112',
  '1113',
  '1114',
  '1115',
  '1116',
  '1117',
  '1119',
  '1120',
  '1121',
  '1123',
  '1124',
  '1125',
  '1126',
  '1127',
  '1130',
  '1131',
  '1132',
  '1133',
  '1134',
  '1136',
  '1137',
  '1138',
  '1139',
  '1140',
  '1141',
  '1153',
  '1156',
  '1157',
  '1158',
  '1159',
  '1160',
  '1161',
  '1162',
  '1163',
  '1164',
  '1165',
  '1166',
  '1167',
  '1168',
  '1169',
  '1170',
  '1171',
  '1172',
  '1173',
  '1174',
  '1175',
  '1176',
  '1178',
  '1179',
  '1180',
  '1181',
  '1182',
  '1183',
  '1184',
  '1185',
  '1186',
  '1187',
  '1190',
  '1191',
  '1193',
  '1199',
  '1200',
  '1201',
  '1202',
  '1204',
  '1206',
  '1207',
  '1208',
  '1209',
  '1211',
  '1212',
  '1213',
  '1216',
  '1217',
  '1218',
  '1219',
  '1220',
  '1222',
  '1224',
  '1225',
  '1226',
  '1227',
  '1228',
  '1231',
  '1232',
  '1233',
  '1234',
  '1235',
  '1236',
  '1237',
  '1238',
  '1240',
  '1241',
  '1242',
  '1243',
  '1244',
  '1245',
  '1246',
  '1247',
  '1250',
  '1252',
  '1253',
  '1254',
  '1256',
  '1257',
  '1258',
  '1259',
  '1260',
  '1262',
  '1264',
  '1265',
  '1266',
  '1267',
  '1268',
  '1269',
  '1271',
  '1272',
  '1274',
  '1275',
  '1276',
  '1277',
  '1278',
  '1279',
  '1280',
  '1281',
  '1282',
  '1283',
  '1284',
  '1285',
  '1286',
  '1287',
  '1290',
  '1291',
  '1292',
  '1296',
  '1297',
  '1298',
  '1299',
  '1300',
  '1301',
  '1302',
  '1306',
  '1307',
  '1309',
  '1310',
  '1313',
  '1315',
  '1316',
  '1317',
  '1318',
  '1319',
  '1320',
  '1321',
  '1322',
  '1323',
  '1324',
  '1325',
  '1326',
  '1327',
  '1328',
  '1329',
  '1330',
  '1331',
  '1411',
  '1469',
  '1477',
  '1495',
  '1498',
  '1702',
  '1720',
  '1775',
  '1918',
  '1904']
  
import time
import datetime


import ROOT
import sys

for id in scanids:
	
	id = int(id)
	if id > 1141: tmp = 1;
	else: tmp = 0
	#if id > 1141: continue
	

	dir = "/var/operation/HVSCAN/%06d" % id
	files = glob.glob("%s/Scan*DAQ.root" % dir)
	
	for f in files:
		
		fOut = ROOT.TFile.Open(f)
		hist = fOut.Get("ID")
		if hist == None: continue
		start = int(hist.GetBinContent(2+tmp))
		end = int(hist.GetBinContent(3+tmp))
		
		
		start = int(time.mktime(datetime.datetime.strptime(str(start), "%Y%m%d%H%M%S").timetuple()))
		end = int(time.mktime(datetime.datetime.strptime(str(end), "%Y%m%d%H%M%S").timetuple()))
		

		hv = int(f.split("_")[1].replace("HV", ""))
		
		print "UPDATE `hvscan_VOLTAGES` SET time_start = %d, time_end = %d WHERE scanid = %d AND HVPoint = %d;" % (start, end, id, hv)

	
